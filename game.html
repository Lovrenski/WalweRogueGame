<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<meta name="author" content="Quist Quest" />
	<meta name="keywords" content="Game, HTML5, HTML, CSS, JavaScript" />
	<meta name="description" content="Quist Quest - Defend the Knowledge" />
	<title>Quist Quest - Defend the Knowledge</title>
	<link rel="stylesheet" type="text/css" href="resources/css/game-ui.css" />
	<link rel="stylesheet" href="resources/css/animationContainerStyle.css">
	<link rel="stylesheet" href="resources/css/knight.css">
	<link rel="stylesheet" href="resources/css/slime.css">
	<link rel="stylesheet" href="resources/css/golem.css">
	<link rel="stylesheet" href="resources/css/jellyfish.css">
	<link rel="stylesheet" href="resources/css/skeleton.css">
	<link rel="stylesheet" href="resources/css/slimeBoss.css">
</head>

<body>
	<div class="game-container">
		<!-- Next level stat -->
		<!-- <div class="next-level-stat">
        <img
          src="./assets/games ui/Next Level.png"
          loading="lazy"
          alt="Next level stat"
        />
      </div> -->

		<!-- Game field -->
		<div class="game-field">
			<!-- Wave indicator -->
			<div class="wave-indicator">Wave 1</div>

			<div id="gameAnimationContainer">
				<div id="allyContainer">
					<div id="knight" data-animate="idle">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
				</div>
				<div id="enemyContainer" class="">
					<div id="slime" data-animate="">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
					<div id="golem" data-animate="">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
					<div id="jellyfish" data-animate="">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
					<div id="skeleton" data-animate="">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
					<div id="slimeBoss" data-animate="">
						<div class="idle"></div>
						<div class="walk"></div>
						<div class="attack"></div>
						<div class="damaged"></div>
						<div class="died"></div>
					</div>
				</div>
			</div>
			<!-- Player info -->
			<div class="player-info-container">
				<div class="player-avatar">
					<!-- <img src="" class="player-sprite" loading="lazy" alt="Knight" /> -->
					<div class="knight-avatar"></div>
					<!-- <div>halo</div> -->
				</div>
				<div class="player-stats ui-box">
					<div class="player-name">Player</div>
					<div class="hp-bar">
						<div id="playerHpBar" class="hp-bar-fill" style="rotate: 180deg; left: 0;"></div>
						<div id="playerHpText" class="hp-text">100/100</div>
					</div>
				</div>
			</div>

			<!-- Enemy info -->
			<div id="enemyInfo" class="enemy-info-container" data-enemy-name="">
				<div class="enemy-stats ui-box">
					<div class="enemy-name">
						<div class="name-slime">Slime</div>
						<div class="name-golem">Golem</div>
						<div class="name-jellyfish">Jellyfish</div>
						<div class="name-skeleton">Skeleton</div>
						<div class="name-slimeBoss">Slime Boss</div>
					</div>
					<div class="hp-bar">
						<div id="enemyHpBar" class="hp-bar-fill" style="right: 0;"></div>
						<div id="enemyHpText" class="hp-text">100/100</div>
					</div>
				</div>
				<div class="enemy-avatar">
					<div class="slime-avatar"></div>
					<div class="golem-avatar"></div>
					<div class="jellyfish-avatar"></div>
					<div class="skeleton-avatar"></div>
					<div class="slimeBoss-avatar"></div>
				</div>
			</div>

			<!-- Mana bar -->
			<!-- <div
            class="mana-bar"
            style="position: absolute; left: 20px; top: 110px"
            >
                <div class="mana-text">10/100</div>
            </div> -->

			<!-- Biome background -->
			<div class="biome-background"></div>
		</div>

		<div class="question-container">
			<div id="question" class="question">1+1=?</div>
			<div id="timer" class="question-timer">
				<div id="questionTimerBar" class="question-timer-fill"></div>
				<div id="questionTimerText" class="question-timer-text">1 seconds</div>
			</div>
			<div class="options-container">
				<div id="options" class="options">
					<div class="option option-1">1</div>
					<div class="option option-2">4</div>
					<div class="option option-3">8</div>
					<div class="option option-4">2</div>
				</div>
			</div>

			<div class="stats-container">
				<!-- <div class="correct-answer">
					<img src="./assets/games ui/BENAR!.png" loading="lazy" alt="Correct answer" />
				</div> -->
				<!-- <div class="wrong-answer">
					<img
					src="./assets/games ui/SALAH!.png"
					loading="lazy"
					alt="Wrong answer"
					/>
				</div> -->
			</div>
		</div>
	</div>
	<script>
		function delay(ms) {
			return new Promise((resolve) => setTimeout(resolve, ms));
		}
		document.addEventListener("DOMContentLoaded", function () {
			let $allyContainer = document.getElementById("allyContainer");
			let $knight = document.getElementById("knight");
			async function animateKnightAttack(enemyElement) {
				$allyContainer.classList.add("move", "z-100");
				$knight.dataset.animate = "walk";
				await delay(700);
				$knight.dataset.animate = "idle";
				await delay(100);
				$knight.dataset.animate = "attack";
				await delay(200);
				enemyElement.dataset.animate = "damaged";
				await delay(300);
				enemyElement.dataset.animate = "idle";
				$knight.dataset.animate = "walk";
				$allyContainer.classList.replace("move", "move-back");
				await delay(700);
				$knight.dataset.animate = "idle";
				$allyContainer.classList.remove("move-back", "z-100");
			}

			let $enemyContainer = document.getElementById("enemyContainer");
			let $slime = document.getElementById("slime");

			async function animateSlimeAttack() {
				$enemyContainer.classList.add("move-slime");
				$slime.dataset.animate = "walk";
				await delay(1400);
				$slime.dataset.animate = "idle";
				await delay(200);
				$slime.dataset.animate = "attack";
				await delay(210);
				$knight.dataset.animate = "damaged";
				await delay(280);
				$slime.dataset.animate = "idle";
				$knight.dataset.animate = "idle";
				await delay(100);
				$enemyContainer.classList.replace("move-slime", "move-back-slime");
				$slime.dataset.animate = "walk_fliped";
				await delay(1700);
				$slime.dataset.animate = "idle";
				$enemyContainer.classList.remove("move-back-slime");
			}

			let $golem = document.getElementById("golem");

			async function animateGolemAttack() {
				$enemyContainer.classList.add("move-golem");
				$golem.dataset.animate = "walk";
				await delay(1030);
				$golem.dataset.animate = "idle";
				await delay(200);
				$enemyContainer.classList.replace("move-golem", "move-golem-attack");
				$golem.dataset.animate = "attack";
				await delay(900);
				$knight.dataset.animate = "damaged";
				await delay(200);
				$knight.dataset.animate = "idle";
				$golem.dataset.animate = "idle";
				await delay(300);
				$golem.dataset.animate = "walk_fliped";
				$enemyContainer.classList.replace(
					"move-golem-attack",
					"move-back-golem"
				);
				await delay(1200);
				$enemyContainer.classList.remove("move-back-golem");
				$golem.dataset.animate = "idle";
			}

			let $jellyfish = document.getElementById("jellyfish");

			async function animateJellyfishAttack() {
				$jellyfish.dataset.animate = "walk";
				$enemyContainer.classList.add("move-jellyfish");
				await delay(1600);
				$jellyfish.dataset.animate = "idle";
				await delay(200);
				$jellyfish.dataset.animate = "attack";
				await delay(200);
				$knight.dataset.animate = "shocked";
				await delay(800);
				$jellyfish.dataset.animate = "idle";
				$knight.dataset.animate = "idle";
				await delay(200);
				$jellyfish.dataset.animate = "walk-back";
				$enemyContainer.classList.replace(
					"move-jellyfish",
					"move-back-jellyfish"
				);
				await delay(1500);
				$jellyfish.dataset.animate = "idle";
				$enemyContainer.classList.remove("move-back-jellyfish");
			}

			let $skeleton = document.getElementById("skeleton");

			async function animateSkeletonAttack() {
				$skeleton.dataset.animate = "walk";
				$enemyContainer.classList.add("move-skeleton");
				await delay(1000);
				$skeleton.dataset.animate = "idle";
				await delay(200);
				$skeleton.dataset.animate = "attack";
				await delay(160);
				$knight.dataset.animate = "damaged";
				await delay(110);
				$skeleton.dataset.animate = "idle";
				await delay(90);
				$knight.dataset.animate = "idle";
				await delay(200);
				$skeleton.dataset.animate = "walk_fliped";
				$enemyContainer.classList.replace(
					"move-skeleton",
					"move-back-skeleton"
				);
				await delay(1000);
				$skeleton.dataset.animate = "idle";
				$enemyContainer.classList.remove("move-back-skeleton");
			}

			let $slimeBoss = document.getElementById("slimeBoss");

			async function animateSlimeBossAttack() {
				$slimeBoss.dataset.animate = "attack";
				$enemyContainer.classList.add("move-slimeBoss");
				await delay(1800);
				$knight.dataset.animate = "damaged";
				await delay(200);
				$knight.dataset.animate = "idle";
				$slimeBoss.dataset.animate = "idle";
				await delay(200);
				$slimeBoss.dataset.animate = "jump-back";
				$enemyContainer.classList.replace(
					"move-slimeBoss",
					"move-back-slimeBoss"
				);
				await delay(2000);
				$slimeBoss.dataset.animate = "idle";
				$enemyContainer.classList.remove("move-back-slimeBoss");
			}

			// let $fullscreenDiv = document.getElementById("fullscreen");
			// let $game = document.getElementById("game");
			// document.getElementById("requestFullscreen").addEventListener("click", function () {
			// 	$fullscreenDiv.requestFullscreen();
			// 	$fullscreenDiv.classList.add("on");
			// 	setTimeout(() => {
			// 		const scale = Math.min(
			// 			$fullscreenDiv.offsetWidth / 1280,
			// 			$fullscreenDiv.offsetHeight / 720
			// 		);
			// 		$game.style.scale = scale;
			// 	}, 50);
			// });
			// document.addEventListener("fullscreenchange", () => {
			// 	if (!document.fullscreenElement) {
			// 		$fullscreenDiv.classList.remove("on");
			// 		$game.style.scale = 1;
			// 	}
			// });


			let $playerHpBar = document.getElementById('playerHpBar');
			let $playerHptext = document.getElementById('playerHpText');
			function changePlayerHpBar($maxHp, $currentHp) {
				$percent = ($currentHp / $maxHp) * 100;
				$playerHpBar.style.width = $percent + '%';
				$playerHptext.innerText = $currentHp + '/' + $maxHp;
			}
			let $enemyHpBar = document.getElementById('enemyHpBar');
			let $enemyHptext = document.getElementById('enemyHpText');
			function changeEnemyHpBar($maxHp, $currentHp) {
				$percent = ($currentHp / $maxHp) * 100;
				$enemyHpBar.style.width = $percent + '%';
				$enemyHptext.innerText = $currentHp + '/' + $maxHp;
			}
			let $questionDiv = document.getElementById('question');
			let $optionsDiv = document.querySelectorAll('#options>.option');
			let $questionTimerBar = document.getElementById('questionTimerBar');
			let $questionTimerText = document.getElementById('questionTimerText');
			let $isTimerCounting = false;
			async function setQuestionTimer($miliseconds) {
				$isTimerCounting = true;
				$questionTimerBar.style.display = 'block';

				let startTime = null;
				let startPosition = 100;
				let endPosition = 0;

				function animateQuestionBar(timestamp) {
					if (!startTime) startTime = timestamp;

					let elapsedTime = timestamp - startTime;
					let progress = Math.min(elapsedTime / $miliseconds, 1);

					let currentPosition = startPosition + (endPosition - startPosition) * progress;
					$questionTimerBar.style.width = currentPosition + '%';
					let remainingTime = (Math.round(($miliseconds - elapsedTime)) / 1000).toFixed(2)
					if (remainingTime > 0) { $questionTimerText.innerHTML = remainingTime + 's' } else { $questionTimerText.innerHTML = '0.00s' };

					if ((progress < 1) && $isTimerCounting) {
						requestAnimationFrame(animateQuestionBar);
					}
				}

				requestAnimationFrame(animateQuestionBar);
			}
			let $enemyInfoDiv = document.getElementById('enemyInfo');

			// contoh update question dan options, simpel si
			$questionDiv.innerHTML = 'aku tambah kamu = ?';
			$optionsDiv[0].innerHTML = 'imposible';
			$optionsDiv[1].innerHTML = 'probably';
			$optionsDiv[2].innerHTML = 'would';
			$optionsDiv[3].innerHTML = 'straight to fun stuf';
			// // contoh update question dan options
			//$optionDiv[_] juga bisa dipake buat kasih .addEventListener()



			// contoh cara jalanin timer display (otomatis langsung jalan setelah fungsi dipanggil)
			setQuestionTimer(4000);
			setTimeout(() => {
				$isTimerCounting = false; // to stop timer do this
			}, 3220);
			// contoh cara jalanin timer display



			// cara ubah avatar dan nama
			$enemyInfoDiv.dataset.enemyName = 'slime';
			// // cara ubah avatar dan nama [slime, golem, jellyfish, skeleton, slimeBoss]



			// contoh cara spawn enemy
			$slime.dataset.animate = 'idle';
			// $golem.dataset.animate = 'idle';
			// $skeleton.dataset.animate = 'idle';
			// $jellyfish.dataset.animate = 'idle';
			// $slimeBoss.dataset.animate = 'idle';
			// // contoh cara spawn enemy
			// cara despawn tinggal dibikin $__.dataset.animate = 'died';



			// contoh jalanin animasi
			animateKnightAttack(document.querySelector('#enemyContainer>[data-animate="idle"]'));
			// animateSlimeAttack();
			// animateGolemAttack();
			// animateSkeletonAttack();
			// animateJellyfishAttack();
			// animateSlimeBossAttack();
			// // contoh jalanin animasi



			// contoh ubah hp
			changePlayerHpBar(100, 50);
			changeEnemyHpBar(50, 20);
			// // contoh ubah hp
		});
	</script>
</body>

</html>